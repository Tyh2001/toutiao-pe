{"version":3,"sources":["webpack:///./src/views/login/index.vue?a553","webpack:///src/views/login/index.vue","webpack:///./src/views/login/index.vue?e0c5","webpack:///./src/views/login/index.vue","webpack:///./src/api/user.js","webpack:///./src/views/login/index.vue?9936"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","on","$event","$router","back","ref","onLogin","onFailed","formRules","mobile","model","value","user","callback","$$v","$set","expression","code","scopedSlots","_u","key","fn","showTime","_e","loading","preventDefault","onSendSms","_v","proxy","staticRenderFns","name","data","methods","message","forbidClick","duration","icon","console","log","err","error","errors","position","component","login","request","method","url","sendSms","getUserInfo","getChannels","followings","cancelFollowings","userId","getUserProfile","changeUserProfile","changeUserPhoto"],"mappings":"yHAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,cAAc,CAACF,EAAG,cAAc,CAACG,MAAM,CAAC,MAAQ,KAAK,aAAa,IAAIC,GAAG,CAAC,aAAa,SAASC,GAAQ,OAAOT,EAAIU,QAAQC,WAAWP,EAAG,WAAW,CAACQ,IAAI,aAAaL,MAAM,CAAC,cAAa,EAAM,sBAAqB,EAAM,iBAAiB,IAAIC,GAAG,CAAC,OAASR,EAAIa,QAAQ,OAASb,EAAIc,WAAW,CAACV,EAAG,YAAY,CAACG,MAAM,CAAC,UAAY,GAAG,cAAc,UAAU,YAAY,SAAS,KAAO,SAAS,YAAc,SAAS,MAAQP,EAAIe,UAAUC,QAAQC,MAAM,CAACC,MAAOlB,EAAImB,KAAW,OAAEC,SAAS,SAAUC,GAAMrB,EAAIsB,KAAKtB,EAAImB,KAAM,SAAUE,IAAME,WAAW,iBAAiBnB,EAAG,YAAY,CAACG,MAAM,CAAC,cAAc,UAAU,YAAY,aAAa,YAAc,SAAS,MAAQP,EAAIe,UAAUS,MAAMC,YAAYzB,EAAI0B,GAAG,CAAC,CAACC,IAAI,SAASC,GAAG,WAAW,MAAO,CAAE5B,EAAY,SAAEI,EAAG,iBAAiB,CAACG,MAAM,CAAC,KAAO,IAAU,OAAS,OAAO,OAAS,IAAIC,GAAG,CAAC,OAAS,SAASC,GAAQT,EAAI6B,UAAW,MAAU7B,EAAI8B,KAAO9B,EAAI6B,SAA+N7B,EAAI8B,KAAzN1B,EAAG,aAAa,CAACE,YAAY,YAAYC,MAAM,CAAC,KAAO,QAAQ,QAAUP,EAAI+B,QAAQ,MAAQ,GAAG,OAAS,IAAIvB,GAAG,CAAC,MAAQ,SAASC,GAAgC,OAAxBA,EAAOuB,iBAAwBhC,EAAIiC,UAAUxB,MAAW,CAACT,EAAIkC,GAAG,aAAsBC,OAAM,KAAQlB,MAAM,CAACC,MAAOlB,EAAImB,KAAS,KAAEC,SAAS,SAAUC,GAAMrB,EAAIsB,KAAKtB,EAAImB,KAAM,OAAQE,IAAME,WAAW,eAAenB,EAAG,MAAM,CAACE,YAAY,UAAU,CAACF,EAAG,aAAa,CAACG,MAAM,CAAC,KAAO,OAAO,MAAQ,KAAK,CAACP,EAAIkC,GAAG,SAAS,IAAI,GAAG9B,EAAG,IAAI,CAACE,YAAY,YAAY,CAACN,EAAIkC,GAAG,gBAAgB9B,EAAG,IAAI,CAACE,YAAY,YAAY,CAACN,EAAIkC,GAAG,kBAAkB9B,EAAG,IAAI,CAACE,YAAY,YAAY,CAACN,EAAIkC,GAAG,uBAAuB,IAC3nDE,EAAkB,G,gDCoFtB,GACEC,KAAM,aACNC,KAFF,WAGI,MAAO,CAELnB,KAAM,CACJH,OAAQ,cACRQ,KAAM,UAGRT,UAAW,CAETC,OAAQ,CAChB,CAAU,UAAV,EAAU,QAAV,UACA,CAAU,QAAV,yEAAU,QAAV,YAIQQ,KAAM,CACd,CAAU,UAAV,EAAU,QAAV,UACA,CAAU,QAAV,aAAU,QAAV,aAGMK,UAAU,EACVE,SAAS,IAGbQ,QAAS,CAEP1B,QAFJ,WAEA,WACM,EAAN,cACQ2B,QAAS,SACTC,aAAa,EACbC,SAAU,IAEZ,OAAN,OAAM,CAAN,6BAEQ,OAAR,OAAQ,CAAR,CACUF,QAAS,OACTG,KAAM,YAGR,EAAR,qCAGQ,EAAR,+CAEQ,EAAR,qBAEA,mBACQ,EAAR,4BACQC,QAAQC,IAAIC,OAShBhC,SAjCJ,SAiCA,GAEUiC,EAAMC,OAAO,IACf,OAAR,OAAQ,CAAR,CACUC,SAAU,MACVT,QAASO,EAAMC,OAAO,GAAGR,WAK/B,UA3CJ,WA2CA,qKAEA,aAFA,kBAIA,yCAJA,uBAOA,8BAPA,OASA,cATA,mDAaA,KAGA,EAFA,8CAEA,OACA,qBAEA,aAGA,YAGA,gBACA,eACA,YAEA,aA7BA,8DC3J8V,I,wBCQ1VU,EAAY,eACd,EACAnD,EACAqC,GACA,EACA,KACA,WACA,MAIa,aAAAc,E,kECnBf,kUASaC,EAAQ,SAAAb,GACnB,OAAOc,eAAQ,CACbC,OAAQ,OACRC,IAAK,2BACLhB,UAKSiB,EAAU,SAAAvC,GACrB,OAAOoC,eAAQ,CACbC,OAAQ,MACRC,IAAK,uBAAF,OAAyBtC,MAKnBwC,EAAc,WACzB,OAAOJ,eAAQ,CACbC,OAAQ,MACRC,IAAK,oBAQIG,EAAc,WACzB,OAAOL,eAAQ,CACbC,OAAQ,MACRC,IAAK,6BAOII,EAAa,SAAApB,GACxB,OAAOc,eAAQ,CACbC,OAAQ,OACRC,IAAK,4BACLhB,UAOSqB,EAAmB,SAAAC,GAC9B,OAAOR,eAAQ,CACbC,OAAQ,SACRC,IAAK,6BAAF,OAA+BM,MAKzBC,EAAiB,WAC5B,OAAOT,eAAQ,CACbC,OAAQ,MACRC,IAAK,4BAKIQ,EAAoB,SAAAxB,GAC/B,OAAOc,eAAQ,CACbC,OAAQ,QACRC,IAAK,yBACLhB,UAKSyB,EAAkB,SAAAzB,GAC7B,OAAOc,eAAQ,CACbC,OAAQ,QACRC,IAAK,uBACLhB,W,kCCvFJ","file":"js/chunk-d2b03fe4.f4334e28.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"loginIndex\"},[_c('van-nav-bar',{attrs:{\"title\":\"登录\",\"left-arrow\":\"\"},on:{\"click-left\":function($event){return _vm.$router.back()}}}),_c('van-form',{ref:\"login-form\",attrs:{\"show-error\":false,\"show-error-message\":false,\"validate-first\":\"\"},on:{\"submit\":_vm.onLogin,\"failed\":_vm.onFailed}},[_c('van-field',{attrs:{\"clearable\":\"\",\"icon-prefix\":\"toutiao\",\"left-icon\":\"shouji\",\"name\":\"mobile\",\"placeholder\":\"请输入手机号\",\"rules\":_vm.formRules.mobile},model:{value:(_vm.user.mobile),callback:function ($$v) {_vm.$set(_vm.user, \"mobile\", $$v)},expression:\"user.mobile\"}}),_c('van-field',{attrs:{\"icon-prefix\":\"toutiao\",\"left-icon\":\"yanzhengma\",\"placeholder\":\"请输入验证码\",\"rules\":_vm.formRules.code},scopedSlots:_vm._u([{key:\"button\",fn:function(){return [(_vm.showTime)?_c('van-count-down',{attrs:{\"time\":1000 * 60,\"format\":\"ss s\",\"center\":\"\"},on:{\"finish\":function($event){_vm.showTime = false}}}):_vm._e(),(!_vm.showTime)?_c('van-button',{staticClass:\"obtainBtn\",attrs:{\"size\":\"small\",\"loading\":_vm.loading,\"round\":\"\",\"center\":\"\"},on:{\"click\":function($event){$event.preventDefault();return _vm.onSendSms($event)}}},[_vm._v(\"获取验证码\")]):_vm._e()]},proxy:true}]),model:{value:(_vm.user.code),callback:function ($$v) {_vm.$set(_vm.user, \"code\", $$v)},expression:\"user.code\"}}),_c('div',{staticClass:\"btnBox\"},[_c('van-button',{attrs:{\"type\":\"info\",\"block\":\"\"}},[_vm._v(\"登录\")])],1)],1),_c('p',{staticClass:\"describe\"},[_vm._v(\"任何手机号都可以登录\")]),_c('p',{staticClass:\"describe\"},[_vm._v(\"接收验证码时间可能会较长\")]),_c('p',{staticClass:\"describe\"},[_vm._v(\"可以使用万能验证码 246810\")])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"loginIndex\">\n    <!-- 导航菜单 -->\n    <van-nav-bar\n      title=\"登录\"\n      left-arrow\n      @click-left=\"$router.back()\"\n    />\n\n    <!-- 表单 -->\n    <!--\n      当表单提交的时候回触发 submit事件\n      只有表单验证通过才会调用 submit 方法\n      所以直接绑定登录按钮的点击事件\n      绑定到这里只有表单验证通过才可以发送请求\n      表单验证不通过不会发送请求\n      :show-error=\"false\" 是否在校验不通过时标红输入框\n      :show-error-message=\"false\" 是否在校验不通过时在输入框下方展示错误提示\n      validate-first 是否在某一项校验不通过时停止校验\n    -->\n    <van-form\n      :show-error=\"false\"\n      :show-error-message=\"false\"\n      ref=\"login-form\"\n      validate-first\n      @submit=\"onLogin\"\n      @failed=\"onFailed\"\n    >\n      <!-- 手机号 -->\n      <van-field\n        clearable\n        v-model=\"user.mobile\"\n        icon-prefix=\"toutiao\"\n        left-icon=\"shouji\"\n        name=\"mobile\"\n        placeholder=\"请输入手机号\"\n        :rules=\"formRules.mobile\"\n      />\n      <!-- 验证码 -->\n      <van-field\n        v-model=\"user.code\"\n        icon-prefix=\"toutiao\"\n        left-icon=\"yanzhengma\"\n        placeholder=\"请输入验证码\"\n        :rules=\"formRules.code\"\n      >\n        <template #button>\n          <!-- 获取验证码倒计时 -->\n          <van-count-down\n            :time=\"1000 * 60\"\n            format=\"ss s\"\n            v-if=\"showTime\"\n            center\n            @finish=\"showTime = false\"\n          />\n          <van-button\n            v-if=\"!showTime\"\n            class=\"obtainBtn\"\n            size=\"small\"\n            :loading=\"loading\"\n            round\n            center\n            @click.prevent=\"onSendSms\"\n          >获取验证码</van-button>\n        </template>\n      </van-field>\n\n      <!-- 登录按钮 -->\n      <div class=\"btnBox\">\n        <!-- 登录的点击事件绑定给了表单 -->\n        <van-button type=\"info\" block>登录</van-button>\n      </div>\n    </van-form>\n\n    <!-- 说明 -->\n    <p class=\"describe\">任何手机号都可以登录</p>\n    <p class=\"describe\">接收验证码时间可能会较长</p>\n    <p class=\"describe\">可以使用万能验证码 246810</p>\n  </div>\n</template>\n\n<script>\n// 登录 - 获取短信验证码\nimport { login, sendSms } from '@/api/user'\nimport { Toast } from 'vant'\nexport default {\n  name: 'loginIndex',\n  data () {\n    return {\n      // 用户信息\n      user: {\n        mobile: '13911111112', // 手机号\n        code: '246810' // 验证码\n      },\n      // 表单验证 required：必填项\n      formRules: {\n        // 手机验证\n        mobile: [\n          { required: true, message: '请输入手机号' },\n          { pattern: /^(13[0-9]|14[5|7]|15[0|1|2|3|4|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\\d{8}$/, message: '手机号格式错误' }\n\n        ],\n        // 验证码验证\n        code: [\n          { required: true, message: '请输入验证码' },\n          { pattern: /^[0-9]{6}$/, message: '验证码格式错误' }\n        ]\n      },\n      showTime: false, // 倒计时显示状态\n      loading: false // 按钮的禁用状态\n    }\n  },\n  methods: {\n    // 登录\n    onLogin () {\n      Toast.loading({\n        message: '登录中...', // 展示的文字\n        forbidClick: true, // 展示时候背景不能点击\n        duration: 0 // 展示时长为 0 时toast 不会消失\n      })\n      login(this.user).then(res => {\n        // console.log(res)\n        Toast({\n          message: '登录成功',\n          icon: 'success'\n        })\n        // 登录成功后 将用户信息数据(token)等数据放到 Vuex 的容器中\n        this.$store.commit('setUser', res.data.data)\n\n        // 在跳转页面之前把 layoutIndex 的缓存清除\n        this.$store.commit('clearCachePages', 'layoutIndex')\n\n        this.$router.push('/')\n        // this.$router.push(this.$router.query.redirect || '/')\n      }).catch(err => {\n        Toast.fail('登录失败，手机号或验证码错误')\n        console.log(err)\n      })\n    },\n    // async 方法\n    // async onLogin () {\n    //   const res = await login(this.user)\n    //   console.log(res)\n    // }\n    // 提交表单且验证不通过后触发\n    onFailed (error) {\n      // 如果 error.errors[0] 有值 就弹窗提示\n      if (error.errors[0]) {\n        Toast({\n          position: 'top',\n          message: error.errors[0].message\n        })\n      }\n    },\n    // 获取验证码\n    async onSendSms () {\n      // this.$refs['login-form'].validate('mobile')\n      this.loading = true // 禁用按钮\n      try {\n        await this.$refs['login-form'].validate('mobile')\n\n        // 验证通过 请求发送验证码\n        await sendSms(this.user.mobile)\n\n        this.showTime = true // 显示倒计时\n      } catch (err) {\n        // console.log('验证失败', err)\n        // console.dir(err)\n        let message = ''\n        if (err && err.request && err.request.status === 429) {\n          // 如果频发发送验证码\n          message = '操作频繁'\n        } else if (err.name === 'mobile') {\n          // 手机验证不通过\n          message = err.message\n        } else {\n          // 未知错误\n          message = '系统异常，稍后再试'\n        }\n        // 提示错误信息\n        Toast({\n          position: 'top',\n          message\n        })\n        this.loading = false // 取消禁用按钮\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.loginIndex {\n  position: fixed;\n  top: 0px;\n  right: 0px;\n  left: 0px;\n  bottom: 0px;\n  background-color: #f5f7f9;\n}\n// 获取验证码的按钮\n.obtainBtn {\n  background-color: #ededed;\n  width: 80px;\n  height: 23px;\n  // 按钮上的文字\n  .van-button__text {\n    color: #666666;\n    font-size: 10px;\n  }\n}\n// 登录按钮盒子\n.btnBox {\n  padding: 26px 14px;\n  // 登录按钮\n  .van-button {\n    background-color: #6db4fb;\n    // 按钮里的文字\n    .van-button__text {\n      font-size: 15px;\n    }\n  }\n}\n// 条款\n.describe {\n  text-align: center;\n  font-size: 15px;\n  color: #666666;\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=5e8cda58&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=5e8cda58&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"5e8cda58\",\n  null\n  \n)\n\nexport default component.exports","/**\n * 用户相关\n */\n\nimport request from '@/utils/request'\n// 使用 Vuex 必须先加载\n// import store from '@/store'\n\n// 登录\nexport const login = data => {\n  return request({\n    method: 'POST',\n    url: '/app/v1_0/authorizations',\n    data\n  })\n}\n\n// 获取短信验证码\nexport const sendSms = mobile => {\n  return request({\n    method: 'GET',\n    url: `/app/v1_0/sms/codes/${mobile}`\n  })\n}\n\n// 获取用户自己信息\nexport const getUserInfo = () => {\n  return request({\n    method: 'GET',\n    url: '/app/v1_0/user'\n    // headers: {\n    //   Authorization: `Bearer ${store.state.user.token}`\n    // }\n  })\n}\n\n// 获取用户频道列表\nexport const getChannels = () => {\n  return request({\n    method: 'GET',\n    url: '/app/v1_0/user/channels'\n  })\n}\n\n// 关注用户\n// 传递关注用户的 id\n// **2021-2-8 关注功能已经不能实现 接口已失效**\nexport const followings = data => {\n  return request({\n    method: 'POST',\n    url: '/app/v1_0/user/followings',\n    data\n  })\n}\n\n// 取消关注用户\n// 取消关注人的 id\n// **2021-2-8 关注功能已经不能实现 接口已失效**\nexport const cancelFollowings = userId => {\n  return request({\n    method: 'DELETE',\n    url: `/app/v1_0/user/followings/${userId}`\n  })\n}\n\n// 获取用户个人资料\nexport const getUserProfile = () => {\n  return request({\n    method: 'GET',\n    url: '/app/v1_0/user/profile'\n  })\n}\n\n// 编辑用户个人资料\nexport const changeUserProfile = data => {\n  return request({\n    method: 'PATCH',\n    url: '/app/v1_0/user/profile',\n    data\n  })\n}\n\n// 编辑用户照片资料（头像）\nexport const changeUserPhoto = data => {\n  return request({\n    method: 'PATCH',\n    url: '/app/v1_0/user/photo',\n    data\n  })\n}\n\n// body 参数使用 data 设置\n// Query 参数使用 params 设置\n// Headers 参数使用 headers 设置\n// Body 参数使用 data 设置\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=5e8cda58&lang=less&scoped=true&\""],"sourceRoot":""}